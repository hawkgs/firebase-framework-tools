{"version":3,"file":"ngx-templates-shared-context-menu.mjs","sources":["../../../projects/shared/context-menu/src/ctx-menu.controller.ts","../../../projects/shared/context-menu/src/ctx-menu/ctx-menu.component.ts","../../../projects/shared/context-menu/src/ctx-menu/ctx-menu.component.html","../../../projects/shared/context-menu/src/ctx-menu.service.ts","../../../projects/shared/context-menu/src/ctx-menu-outlet/ctx-menu-outlet.component.ts","../../../projects/shared/context-menu/src/ctx-menu-outlet/ctx-menu-outlet.component.html","../../../projects/shared/context-menu/ngx-templates-shared-context-menu.ts"],"sourcesContent":["import { WritableSignal } from '@angular/core';\nimport { CtxMenu } from './types';\n\nexport class CtxMenuController<T = void> {\n  private _resolver!: (v: T | undefined) => void;\n\n  constructor(\n    private _menu: WritableSignal<CtxMenu<unknown, unknown> | null>,\n  ) {}\n\n  /**\n   * A `Promise` that is resolved when the target modal is closed.\n   */\n  closed = new Promise<T | undefined>((res) => {\n    this._resolver = res;\n  });\n\n  /**\n   * Close the target modal.\n   *\n   * @param result Provided response data\n   */\n  close(result?: T) {\n    this._menu.set(null);\n    this._resolver(result);\n  }\n}\n","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  computed,\n  ElementRef,\n  HostListener,\n  inject,\n  InjectionToken,\n  Injector,\n  input,\n  signal,\n  StaticProvider,\n  viewChild,\n  ViewContainerRef,\n} from '@angular/core';\nimport { WINDOW, provideWindow } from '@ngx-templates/shared/services';\n\nimport { CtxMenu } from '../types';\nimport { CtxMenuController } from '../ctx-menu.controller';\n\nconst COOR_MARGIN = 15; // px\n\nexport const CTX_MENU_DATA = new InjectionToken('CTX_MENU_DATA');\n\n@Component({\n  selector: 'ngx-ctx-menu',\n  imports: [],\n  providers: [provideWindow()],\n  templateUrl: './ctx-menu.component.html',\n  styleUrl: './ctx-menu.component.scss',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CtxMenuComponent<D, R> implements AfterViewInit {\n  private _win = inject(WINDOW);\n\n  menu = input.required<CtxMenu<D, R>>();\n\n  container = viewChild.required<ElementRef>('container');\n  content = viewChild.required('content', { read: ViewContainerRef });\n\n  posOffset = signal<{ x: number; y: number }>({ x: 0, y: 0 });\n\n  // Position of the menu\n  translate = computed(() => {\n    const scrollX = this._win.scrollX;\n    const scrollY = this._win.scrollY;\n\n    let { x, y } = this.menu().coor;\n\n    x += scrollX + COOR_MARGIN + this.posOffset().x;\n    y += scrollY + COOR_MARGIN + this.posOffset().y;\n\n    return `translate(${x}px, ${y}px)`;\n  });\n\n  ngAfterViewInit() {\n    const menu = this.menu();\n    const injector = this._createInjector(menu);\n    this.content().createComponent(menu.component, { injector });\n\n    this._calculatePositionOffset();\n  }\n\n  @HostListener('document:mousedown')\n  onDocumentMousedown() {\n    this.menu()?.controller.close();\n  }\n\n  private _createInjector(ctxMenu: CtxMenu<D, R>) {\n    const providers: StaticProvider[] = [\n      {\n        provide: CTX_MENU_DATA,\n        useValue: ctxMenu.data,\n      },\n      {\n        provide: CtxMenuController,\n        useValue: ctxMenu.controller,\n      },\n    ];\n\n    return Injector.create({\n      providers,\n      parent: ctxMenu.config.injector,\n    });\n  }\n\n  private _calculatePositionOffset() {\n    const { width, height } =\n      this.container().nativeElement.getBoundingClientRect();\n    const { x, y } = this.menu().coor;\n\n    const offset = { x: 0, y: 0 };\n    const x2 = x + width;\n    const y2 = y + height;\n\n    if (x2 >= this._win.innerWidth) {\n      offset.x = -width - COOR_MARGIN * 2;\n    }\n    if (y2 >= this._win.innerHeight) {\n      offset.y = -height - COOR_MARGIN * 2;\n    }\n\n    this.posOffset.set(offset);\n  }\n}\n","<!-- eslint-disable-next-line -->\n<div\n  #container\n  class=\"ctx-menu\"\n  [style.transform]=\"translate()\"\n  (mousedown)=\"$event.stopPropagation()\"\n>\n  <ng-container #content />\n</div>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Injectable, signal, Type } from '@angular/core';\nimport { CtxMenuController } from './ctx-menu.controller';\nimport { CtxMenu, CtxMenuConfig } from './types';\n\nconst DEFAULT_CONFIG: CtxMenuConfig = {};\n\n@Injectable({ providedIn: 'root' })\nexport class CtxMenuService {\n  private _menu = signal<CtxMenu<any, any> | null>(null);\n  menu = this._menu.asReadonly();\n\n  /**\n   * Open a context menu.\n   *\n   * @param component The component representing the menu\n   * @param event A mouse event with the absolute coordinates relative to the viewport\n   * @param data Data passed to the menu\n   */\n  openMenu<D = void, R = void>(\n    component: Type<unknown>,\n    event: MouseEvent,\n    data?: D,\n    config?: Partial<CtxMenuConfig>,\n  ): CtxMenuController<R> {\n    event.stopPropagation();\n\n    const controller = new CtxMenuController<R>(this._menu);\n    const coor = {\n      x: event.clientX,\n      y: event.clientY,\n    };\n\n    const ctxMenu: CtxMenu<D, R> = {\n      component,\n      data,\n      controller,\n      coor,\n      config: { ...DEFAULT_CONFIG, ...config },\n    };\n    this._menu.set(ctxMenu);\n\n    return controller;\n  }\n}\n","import { ChangeDetectionStrategy, Component, inject } from '@angular/core';\nimport { CtxMenuService } from '../ctx-menu.service';\nimport { CtxMenuComponent } from '../ctx-menu/ctx-menu.component';\n\n@Component({\n  selector: 'ngx-ctx-menu-outlet',\n  imports: [CtxMenuComponent],\n  templateUrl: './ctx-menu-outlet.component.html',\n  styleUrl: './ctx-menu-outlet.component.scss',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class CtxMenuOutletComponent {\n  ctxMenu = inject(CtxMenuService);\n}\n","@if (ctxMenu.menu(); as menu) {\n  <ngx-ctx-menu [menu]=\"menu\" />\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}